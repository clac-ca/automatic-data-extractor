<a class="skip-link" href="#main-content">Skip to main content</a>

<div class="app-shell" [ngClass]="{ 'app-shell--sidebar-collapsed': !sidebarOpen() }">
  <header class="app-shell__header">
    <button
      type="button"
      class="app-shell__sidebar-toggle"
      [disabled]="!workspaceNavVisible()"
      [attr.aria-expanded]="workspaceNavVisible() ? sidebarOpen() : false"
      (click)="toggleSidebar()"
    >
      <span class="visually-hidden">Toggle workspace navigation</span>
      <span aria-hidden="true" class="app-shell__sidebar-icon">|||</span>
    </button>
    <div class="app-shell__brand">
      <span class="app-shell__brand-title">Automatic Data Extractor</span>
      @if (loadingWorkspaces()) {
        <span class="app-shell__workspace-status" role="status">Loading workspacesâ€¦</span>
      } @else if (workspaceError()) {
        <div class="app-shell__workspace-status app-shell__workspace-status--error" role="alert">
          <span>{{ workspaceError() }}</span>
          <button type="button" class="app-shell__workspace-retry" (click)="retryWorkspaceLoad()">
            Retry
          </button>
        </div>
      } @else if (hasWorkspaces()) {
        <label class="app-shell__workspace-switcher">
          <span class="visually-hidden">Choose workspace</span>
          <select
            class="app-shell__workspace-select"
            [value]="activeWorkspaceId()"
            (change)="onWorkspaceSelect($any($event.target).value || '')"
          >
            @for (workspace of workspaces(); track workspace.id) {
              <option [value]="workspace.id">{{ workspace.name }}</option>
            }
          </select>
        </label>
      } @else {
        <span class="app-shell__workspace-status">No workspaces available yet.</span>
      }
      @if (activeWorkspace(); as workspace) {
        <span class="app-shell__workspace-meta">
          <span class="app-shell__workspace-label">Workspace</span>
          <span class="app-shell__workspace-name">{{ workspace.name }}</span>
        </span>
      }
    </div>
    <nav class="app-shell__global-nav" aria-label="Global navigation">
      <a
        [routerLink]="workspaceDocumentsLink()"
        routerLinkActive="is-active"
        [routerLinkActiveOptions]="{ exact: false }"
      >
        Workspaces
      </a>
      <a routerLink="/settings" routerLinkActive="is-active">Settings</a>
    </nav>
  </header>

  <div class="app-shell__body">
    @if (workspaceNavVisible()) {
      <aside class="app-shell__sidebar" aria-label="Workspace navigation">
        <h2 class="app-shell__sidebar-heading">Workspace navigation</h2>
        <ul class="app-shell__sidebar-links">
          @for (link of workspaceNavLinks; track link.path) {
            <li>
              <a [routerLink]="workspaceLink(link.path)" routerLinkActive="is-active">
                {{ link.label }}
              </a>
            </li>
          }
        </ul>
      </aside>
    }

    <main id="main-content" class="app-shell__content" role="main">
      <router-outlet />
    </main>
  </div>
</div>
