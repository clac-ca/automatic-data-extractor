# Backend feature-first refactor

Owner: jkropp
Status: done
Created: 2025-10-20T01:48:45.677Z

---
- 2025-10-20T01:48:57.669Z • jkropp: Kickoff: document current backend layers, draft feature-slice folder plan (auth, workspaces, ingestion, etc.), and prepare migration steps for routers, schemas, services.
- 2025-10-20T01:50:12.948Z • jkropp: Inventory: current FastAPI backend is layer-driven. api/v1 routers = auth.py, documents.py, health.py, jobs.py, users.py, workspaces.py (each Simple APIRouter); services mirror those files (auth_service, documents_service, jobs_service, users_service, workspaces_service) and call in-memory repos; schemas aligned by feature (auth.py, documents.py, jobs.py, users.py, workspaces.py); repositories include base.py + in-memory documents/jobs/users; shared folders: core (config, logging, security, errors), db (session + model stubs), web/static. No cross-feature logic beyond shared Repository base and schema imports.
- 2025-10-20T01:50:20.772Z • jkropp: Proposed feature-first layout: introduce backend/app/features/ with one folder per vertical (auth, documents, jobs, users, workspaces, system_health). Each folder owns router.py (FastAPI APIRouter), schemas.py (Pydantic models), service.py (business logic), repository.py (data access). Shared building blocks move under backend/app/shared/ (core config + logging, db/session, repository base class, security helpers). backend/app/api/router.py can compose the root APIRouter by including each feature's router. backend/app/main.py (or existing FastAPI factory) imports from features rather than layer modules.
- 2025-10-20T01:50:26.998Z • jkropp: Migration outline: 1) Scaffold backend/app/features/* folders + backend/app/shared for common libs. 2) Move each feature's schemas/service/repository/router into its folder; keep __init__.py exporting router + schemas for shorter imports. 3) Update FastAPI app factory (api/__init__.py, main.py) to import feature routers from backend.app.features.<feature>.router. 4) Point services to local repository instances (features/<feature>/repository.py) and drop layer-level modules. 5) Relocate Repository base + DB session helpers under shared/ and update imports. 6) Adjust tests + type stubs to new module paths, regenerate openapi types. 7) Remove deprecated layer directories once imports/tests pass; run npm run test + npm run ci as guardrails.
- 2025-10-20T01:58:41.434Z • jkropp: Reorganized backend to feature slices under app/features, relocating routers/services/schemas/repositories per vertical and moving shared config/db/repository base into app/shared. Updated FastAPI wiring to import feature routers, refreshed backend docs to describe the new layout, and executed npm run test + npm run ci to validate code, build, and regenerated API types.
- 2025-10-20T02:02:21.629Z • jkropp: Follow-up: swept repository for imports pointing to removed app.services/schemas/repositories layers; none found. Updated README project structure with feature-first layout details and cleaned build artifacts (restored static/.gitkeep). No code changes, so tests were not re-run.
- 2025-10-20T02:18:50.657Z • jkropp: Wrap-up: feature-first backend structure landed and docs/tests updated. Verified CI build succeeds on new layout. Marking work package complete.
