# -----------------------------------------------------------------------------
# ADE environment template
# Copy to `.env` and tweak values as needed.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# Core backend settings (defaults mirror Settings model)
# -----------------------------------------------------------------------------
# Set to true to expose FastAPI's interactive docs at /docs and /redoc.
ADE_API_DOCS_ENABLED=false
# Base log level for ADE services (API/worker/engine/web).
ADE_LOG_LEVEL=INFO
# Optional per-service overrides.
# ADE_API_LOG_LEVEL=INFO
# ADE_WORKER_LOG_LEVEL=INFO
# ADE_ENGINE_LOG_LEVEL=INFO
# ADE_WEB_LOG_LEVEL=info  # Vite log levels: info|warn|error|silent (DEBUG maps to info)
# Keep ADE online for troubleshooting without executing user config code.
# When true the API serves existing data but job submissions return HTTP 400.
ADE_SAFE_MODE=false

# Public origin that browsers and webhooks should use. Defaults to localhost
# for development, but switch it to your DNS name (including https://) when you
# publish ADE behind a reverse proxy. Example:
# `ADE_SERVER_PUBLIC_URL=https://ade.example.com`
ADE_SERVER_PUBLIC_URL=http://localhost:8000
# Frontend origin used for browser redirects after SSO callbacks.
# Defaults to ADE_SERVER_PUBLIC_URL when not provided.
# ADE_FRONTEND_URL=http://localhost:5173

# Additional origins for CORS. Provide a JSON array (e.g. ["http://localhost:5173"]).
# Include the frontend dev server for local work. In production add hosted domains,
# such as `https://ade.example.com` for the shipped UI.
ADE_SERVER_CORS_ORIGINS=["http://localhost:5173"]

# JWT settings for session cookies. Defaults match the development profile.
# Required: used to sign session cookies and bearer tokens. If left blank ADE
# will generate a random value on each start (all sessions/tokens will break on
# restart and cannot be shared across replicas). Generate with:
# python - <<'PY'
# import secrets
# print(secrets.token_urlsafe(64))
# PY
# ADE_JWT_SECRET=
ADE_JWT_ACCESS_TTL=60m
ADE_JWT_REFRESH_TTL=14d
# Lockout policy for repeated failed password attempts.
ADE_FAILED_LOGIN_LOCK_THRESHOLD=5
ADE_FAILED_LOGIN_LOCK_DURATION=5m

# -----------------------------------------------------------------------------
# Runtime directories (created automatically if they do not exist).
# -----------------------------------------------------------------------------
# Directory roots for workspace storage and cache locations.
# Defaults point to ./data/workspaces/...; ADE nests the workspace ID under each root.
# ADE_WORKSPACES_DIR=./data/workspaces
# ADE_DOCUMENTS_DIR=./data/workspaces
# ADE_CONFIGS_DIR=./data/workspaces
# ADE_CONFIG_TEMPLATES_SOURCE_DIR=./apps/ade-api/src/ade_api/templates/config_packages
# ADE_CONFIG_TEMPLATES_DIR=./data/templates/config_packages
# ADE_VENVS_DIR=./data/venvs
# Engine install spec for builds (path or pip-style spec).
# ADE_ENGINE_SPEC=apps/ade-engine
# ADE_RUNS_DIR=./data/workspaces
# ADE_PIP_CACHE_DIR=./data/cache/pip
# Maximum upload size (bytes); defaults to 25 MiB.
ADE_STORAGE_UPLOAD_MAX_BYTES=26214400
# Document retention window (accepts seconds or suffixed strings like 30d).
ADE_STORAGE_DOCUMENT_RETENTION_PERIOD=30d

# -----------------------------------------------------------------------------
# Database
# -----------------------------------------------------------------------------
# ADE_DATABASE_URL defaults to the bundled SQLite database; uncomment to point
# at Azure SQL or a different file path when you deploy.
# ADE_DATABASE_URL=sqlite:///./data/db/ade.sqlite
#
# For Azure SQL (SQL auth):
# ADE_DATABASE_URL=mssql+pyodbc://user:password@<server>.database.windows.net:1433/<database>?driver=ODBC+Driver+18+for+SQL+Server&Encrypt=yes&TrustServerCertificate=no&Connection+Timeout=30
# ADE_DATABASE_AUTH_MODE=sql_password
#
# For Azure SQL (managed identity):
# ADE_DATABASE_URL=mssql+pyodbc://@<server>.database.windows.net:1433/<database>?driver=ODBC+Driver+18+for+SQL+Server&Encrypt=yes&TrustServerCertificate=no&Connection+Timeout=30
# ADE_DATABASE_AUTH_MODE=managed_identity
# ADE_DATABASE_MI_CLIENT_ID=<user-assigned-client-id-if-needed>

# SQLAlchemy echo logging (prints every SQL statement).
# Use only for short-lived troubleshooting; it is very noisy and can expose data in logs.
# ADE_DATABASE_ECHO=false
# SQLAlchemy logger verbosity (overrides ADE_LOGGING_LEVEL for SQL only).
# Example: DEBUG to see SQL statements without turning the whole app to DEBUG.
# Use sparingly; it can be extremely noisy and may log sensitive values.
# ADE_DATABASE_LOG_LEVEL=DEBUG

# SQLite concurrency tuning (optional, defaults shown)
# ADE_DATABASE_SQLITE_JOURNAL_MODE=WAL
# ADE_DATABASE_SQLITE_SYNCHRONOUS=NORMAL
# ADE_DATABASE_SQLITE_BUSY_TIMEOUT_MS=30000
# ADE_DATABASE_SQLITE_BEGIN_MODE=DEFERRED
# Fail fast if Alembic migrations hang (seconds). Set <=0 to disable timeout.
# ADE_DATABASE_MIGRATION_TIMEOUT_S=15

# -----------------------------------------------------------------------------
# Job execution & worker limits
# -----------------------------------------------------------------------------
# Maximum number of concurrent jobs each worker process will execute.
# ADE_WORKER_CONCURRENCY=1
# Maximum number of queued jobs before new submissions are rejected.
# ADE_QUEUE_SIZE=10
# Poll interval for idle workers (seconds).
# ADE_WORKER_POLL_INTERVAL=2
# Background cleanup interval for leases/timeouts (seconds).
# ADE_WORKER_CLEANUP_INTERVAL=30
# Lease TTL for claimed jobs (seconds).
# ADE_WORKER_JOB_LEASE_SECONDS=900
# Max retry attempts before marking a job failed.
# ADE_WORKER_JOB_MAX_ATTEMPTS=3
# Backoff base and max for retries (seconds).
# ADE_WORKER_JOB_BACKOFF_BASE_SECONDS=5
# ADE_WORKER_JOB_BACKOFF_MAX_SECONDS=300
# Worker log level override (see ADE_WORKER_LOG_LEVEL above).
# Per-job wall-clock timeout enforced by the worker (seconds).
# ADE_RUN_TIMEOUT_SECONDS=300
# Per-build wall-clock timeout (seconds).
# ADE_BUILD_TIMEOUT=600
# Hard limits applied to each worker subprocess (best-effort via rlimit).
# ADE_WORKER_CPU_SECONDS=60
# ADE_WORKER_MEM_MB=512
# ADE_WORKER_FSIZE_MB=100

# -----------------------------------------------------------------------------
# Optional OpenID Connect configuration
# -----------------------------------------------------------------------------
# Enable and configure OIDC login by providing the core fields below. Scopes
# accept a space separated list (they will be deduplicated and sorted).
# ---------------------------------------------------------------------------
# Example Microsoft Entra ID (Azure AD) OpenID Connect configuration
# ---------------------------------------------------------------------------
# Enable OIDC authentication via Entra ID (Azure AD)
# ADE_OIDC_ENABLED=true
# ADE_OIDC_CLIENT_ID=your-entra-app-client-id
# ADE_OIDC_CLIENT_SECRET=your-entra-app-client-secret
# ADE_OIDC_ISSUER=https://login.microsoftonline.com/<tenant-id>/v2.0
# ADE_OIDC_REDIRECT_URL=/auth/callback
# ADE_OIDC_SCOPES=["openid","email","profile"]
# Toggle SSO behaviour once the base OIDC variables are configured.
# ADE_AUTH_FORCE_SSO=false
# ADE_AUTH_SSO_AUTO_PROVISION=true

# -----------------------------------------------------------------------------
# Local development helpers
# -----------------------------------------------------------------------------
# Set to true to bypass authentication/authorization for local debugging.
# WARNING: Never enable this outside of an isolated dev environment.
# ADE_AUTH_DISABLED=false
# ADE_AUTH_DISABLED_USER_EMAIL=developer@example.com
# ADE_AUTH_DISABLED_USER_NAME=Development User
