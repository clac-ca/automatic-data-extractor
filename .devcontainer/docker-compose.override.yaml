# Devcontainer compose override.
# Anything defined here will override or extend the root docker-compose.yaml.

services:
  ade:
    image: automatic-data-extractor:devcontainer
    build:
      target: development # Uses development stage (editable install + dev deps).
    command: ["sleep", "infinity"] # Keep container alive for VS Code attach; avoid exiting on `ade start` failures.
    volumes:
      # Bind host ~/.codex; create_host_path avoids failures on host machines that never installed Codex.
      - type: bind
        source: ${HOME}/.codex
        target: /home/appuser/.codex
        bind:
          create_host_path: true
      # Mount the repo into /app for live code edits inside the devcontainer.
      - .:/app:cached
    tmpfs:
      # Allow ade-web entrypoint to write nginx config when devcontainer updates appuser UID.
      - /etc/nginx/conf.d:uid=1000,gid=1000,mode=755
